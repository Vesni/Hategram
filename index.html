<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 10 A - Homework Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .homework-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .homework-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .priority-high { border-left-color: #ef4444; }
        .priority-medium { border-left-color: #f59e0b; }
        .priority-low { border-left-color: #10b981; }
        
        .notification {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .answer-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .locked-overlay {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .completion-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .reminder-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <!-- Header -->
    <header class="glass-effect shadow-lg border-b border-white/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center space-x-4">
                    <div class="gradient-bg p-3 rounded-xl shadow-lg">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">Grade 10 A</h1>
                        <p class="text-sm text-gray-600">Homework Tracker</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button onclick="requestNotificationPermission()" id="notificationBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-lg transition-all transform hover:scale-105 reminder-pulse">
                        üîî Enable Reminders
                    </button>
                    <div id="userInfo" class="text-right">
                        <p class="text-sm font-medium text-gray-900" id="currentUser">Not logged in</p>
                        <p class="text-xs text-gray-500" id="userRole">Guest</p>
                    </div>
                    <button onclick="showAuthModal()" id="authBtn" class="gradient-bg text-white px-6 py-2 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all transform hover:scale-105">
                        Login / Register
                    </button>
                    <button onclick="logout()" id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-medium shadow-lg transition-all transform hover:scale-105 hidden">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-6">
        <div class="flex space-x-1 bg-white/50 backdrop-blur-sm p-1 rounded-xl shadow-lg">
            <button onclick="switchTab('homework')" id="homeworkTab" class="tab-button flex-1 py-3 px-6 rounded-lg font-medium transition-all transform hover:scale-105 active">
                üìö Homework
            </button>
            <button onclick="switchTab('answers')" id="answersTab" class="tab-button flex-1 py-3 px-6 rounded-lg font-medium transition-all transform hover:scale-105">
                üìù Answers
            </button>
            <button onclick="switchTab('reminders')" id="remindersTab" class="tab-button flex-1 py-3 px-6 rounded-lg font-medium transition-all transform hover:scale-105">
                üîî Reminders
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Homework Tab -->
        <div id="homeworkContent" class="tab-content active">
            <!-- Admin Panel -->
            <div id="adminPanel" class="hidden mb-8">
                <div class="glass-effect rounded-2xl shadow-xl p-6 border border-white/20">
                    <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                        <svg class="w-6 h-6 text-indigo-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Add New Homework
                    </h2>
                    <form id="homeworkForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                            <select id="subject" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="">Select Subject</option>
                                <option value="Mathematics">Mathematics</option>
                                <option value="English">English</option>
                                <option value="Science">Science</option>
                                <option value="History">History</option>
                                <option value="Geography">Geography</option>
                                <option value="Physics">Physics</option>
                                <option value="Chemistry">Chemistry</option>
                                <option value="Biology">Biology</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                            <select id="priority" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="high">üî¥ High Priority</option>
                                <option value="medium">üü° Medium Priority</option>
                                <option value="low">üü¢ Low Priority</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Assignment Title</label>
                            <input type="text" id="title" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter assignment title">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <textarea id="description" required rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter assignment details"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Due Date</label>
                            <input type="date" id="dueDate" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Due Time</label>
                            <input type="time" id="dueTime" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="w-full gradient-bg text-white py-3 px-6 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all transform hover:scale-105">
                                ‚ûï Add Homework Assignment
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Progress Dashboard -->
            <div class="glass-effect rounded-2xl shadow-xl p-6 border border-white/20 mb-8">
                <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <svg class="w-6 h-6 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    Your Progress Dashboard
                </h2>
                <div id="progressDashboard">
                    <!-- Progress content will be rendered here -->
                </div>
            </div>

            <!-- Homework List -->
            <div class="glass-effect rounded-2xl shadow-xl border border-white/20">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-xl font-bold text-gray-900 flex items-center">
                        <svg class="w-6 h-6 text-indigo-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        All Assignments
                    </h2>
                </div>
                <div id="homeworkList" class="p-6">
                    <!-- Homework items will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Answers Tab -->
        <div id="answersContent" class="tab-content">
            <div class="glass-effect rounded-2xl shadow-xl border border-white/20">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold text-gray-900 flex items-center">
                            <svg class="w-6 h-6 text-purple-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Answer Keys
                        </h2>
                        <div id="adminAnswerControls" class="hidden flex items-center space-x-4">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="enableAnswers" onchange="toggleAnswerAccess()" class="rounded">
                                <span class="text-sm font-medium">Enable Student Access</span>
                            </label>
                            <button onclick="showAddAnswerModal()" class="gradient-bg text-white px-4 py-2 rounded-lg text-sm font-medium shadow-lg hover:shadow-xl transition-all">
                                Add Answer Key
                            </button>
                        </div>
                    </div>
                </div>
                <div id="answersContainer" class="p-6">
                    <!-- Answers will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Reminders Tab -->
        <div id="remindersContent" class="tab-content">
            <div class="glass-effect rounded-2xl shadow-xl border border-white/20">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold text-gray-900 flex items-center">
                            <svg class="w-6 h-6 text-yellow-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM4.828 4.828A4 4 0 015.5 4H9v1H5.5a3 3 0 00-2.121.879l-.707.707A1 1 0 002 7.414V11H1V7.414a2 2 0 01.586-1.414l.707-.707A5 5 0 015.5 4H9V3a1 1 0 011-1h4a1 1 0 011 1v1h3.5a5 5 0 013.207 1.293l.707.707A2 2 0 0123 7.414V11h-1V7.414a1 1 0 00-.293-.707l-.707-.707A4 4 0 0018.5 5H15V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v1H5.5a4 4 0 00-2.828 1.172z"></path>
                            </svg>
                            Notification Center
                        </h2>
                        <div id="adminReminderControls" class="hidden">
                            <button onclick="showSendReminderModal()" class="gradient-bg text-white px-4 py-2 rounded-lg text-sm font-medium shadow-lg hover:shadow-xl transition-all">
                                üì¢ Send Reminder
                            </button>
                        </div>
                    </div>
                </div>
                <div id="remindersContainer" class="p-6">
                    <div class="mb-6">
                        <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-lg font-bold mb-2">üîî Notification Settings</h3>
                            <p class="text-yellow-100 mb-4">Enable notifications to receive automatic reminders for upcoming homework deadlines!</p>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-yellow-100">Status: <span id="notificationStatus" class="font-semibold">Not enabled</span></p>
                                    <p class="text-xs text-yellow-200 mt-1">Get reminders 24h and 1h before due dates</p>
                                </div>
                                <button onclick="requestNotificationPermission()" id="enableNotificationsBtn" class="bg-white text-orange-600 px-4 py-2 rounded-lg font-medium hover:bg-gray-100 transition-colors">
                                    Enable Now
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="reminderHistory">
                        <!-- Reminder history will be rendered here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-2xl shadow-2xl p-8 max-w-md w-full bounce-in">
            <div class="text-center mb-6">
                <div class="gradient-bg p-4 rounded-full w-16 h-16 mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-900">Welcome!</h3>
                <p class="text-sm text-gray-600 mt-2">Login or register to access homework tracker</p>
            </div>
            <form id="authForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter your email">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                    <input type="text" id="name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter your full name">
                </div>
                <div class="flex space-x-3">
                    <button type="button" onclick="hideAuthModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 px-4 rounded-lg font-medium transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 gradient-bg text-white py-3 px-4 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all">
                        Continue
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Answer Modal -->
    <div id="addAnswerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-2xl shadow-2xl p-8 max-w-2xl w-full bounce-in max-h-[90vh] overflow-y-auto">
            <div class="text-center mb-6">
                <h3 class="text-xl font-bold text-gray-900">Add Answer Key</h3>
                <p class="text-sm text-gray-600 mt-2">Upload answer key with text and images</p>
            </div>
            <form id="answerForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Select Homework</label>
                    <select id="answerHomeworkId" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">Choose homework assignment</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Answer Key Content</label>
                    <textarea id="answerContent" required rows="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter the answer key or solution..."></textarea>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Add Images (Optional)</label>
                    <input type="file" id="answerImages" multiple accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <p class="text-xs text-gray-500 mt-1">You can select multiple images. They will be displayed with your answer key.</p>
                    <div id="imagePreview" class="mt-4 grid grid-cols-2 md:grid-cols-3 gap-4"></div>
                </div>
                <div class="flex space-x-3">
                    <button type="button" onclick="hideAddAnswerModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 px-4 rounded-lg font-medium transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 gradient-bg text-white py-3 px-4 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all">
                        Add Answer Key
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Send Reminder Modal -->
    <div id="sendReminderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-2xl shadow-2xl p-8 max-w-lg w-full bounce-in">
            <div class="text-center mb-6">
                <h3 class="text-xl font-bold text-gray-900">Send Custom Reminder</h3>
                <p class="text-sm text-gray-600 mt-2">Send a notification to all users</p>
            </div>
            <form id="reminderForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Reminder Title</label>
                    <input type="text" id="reminderTitle" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter reminder title">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Reminder Message</label>
                    <textarea id="reminderMessage" required rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter your reminder message..."></textarea>
                </div>
                <div class="flex space-x-3">
                    <button type="button" onclick="hideSendReminderModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 px-4 rounded-lg font-medium transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 gradient-bg text-white py-3 px-4 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all">
                        üì¢ Send Reminder
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // App state
        let currentUser = null;
        let homeworks = [];
        let answers = [];
        let answersEnabled = false;
        let currentTab = 'homework';
        let userCompletions = {}; // Track individual user completions
        let reminderHistory = [];
        let notificationsEnabled = false;

        // Admin email
        const ADMIN_EMAIL = 'vesni277@gmail.com';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateUI();
            renderHomeworks();
            renderProgressDashboard();
            renderAnswers();
            renderReminders();
            checkNotificationPermission();
            setupReminderSystem();
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dueDate').min = today;
            
            // Event listeners
            document.getElementById('authForm').addEventListener('submit', handleAuth);
            document.getElementById('homeworkForm').addEventListener('submit', handleAddHomework);
            document.getElementById('answerForm').addEventListener('submit', handleAddAnswer);
            document.getElementById('reminderForm').addEventListener('submit', handleSendReminder);
            document.getElementById('answerImages').addEventListener('change', handleImagePreview);
            
            // Setup automatic sync every 30 seconds
            setInterval(syncData, 30000);
            
            // Sync when page becomes visible (user switches back to tab)
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    syncData();
                }
            });
            
            // Initial sync after 2 seconds
            setTimeout(syncData, 2000);
        });

        // Notification system
        function checkNotificationPermission() {
            if ('Notification' in window) {
                const permission = Notification.permission;
                updateNotificationStatus(permission);
                
                if (permission === 'granted') {
                    notificationsEnabled = true;
                    document.getElementById('notificationBtn').style.display = 'none';
                }
            } else {
                updateNotificationStatus('not-supported');
            }
        }

        function updateNotificationStatus(status) {
            const statusEl = document.getElementById('notificationStatus');
            const btnEl = document.getElementById('enableNotificationsBtn');
            
            switch (status) {
                case 'granted':
                    statusEl.textContent = '‚úÖ Enabled';
                    statusEl.className = 'font-semibold text-green-200';
                    btnEl.textContent = 'Enabled';
                    btnEl.disabled = true;
                    btnEl.className = 'bg-green-200 text-green-800 px-4 py-2 rounded-lg font-medium cursor-not-allowed';
                    document.getElementById('notificationBtn').style.display = 'none';
                    break;
                case 'denied':
                    statusEl.textContent = '‚ùå Blocked';
                    statusEl.className = 'font-semibold text-red-200';
                    btnEl.textContent = 'Blocked';
                    btnEl.disabled = true;
                    break;
                case 'not-supported':
                    statusEl.textContent = '‚ùå Not Supported';
                    statusEl.className = 'font-semibold text-gray-200';
                    btnEl.style.display = 'none';
                    break;
                default:
                    statusEl.textContent = '‚è≥ Not enabled';
                    statusEl.className = 'font-semibold text-yellow-200';
            }
        }

        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    updateNotificationStatus(permission);
                    if (permission === 'granted') {
                        notificationsEnabled = true;
                        showNotification('Notifications enabled! You\'ll receive homework reminders.', 'success');
                        setupReminderSystem();
                    } else {
                        showNotification('Notifications blocked. You won\'t receive reminders.', 'warning');
                    }
                });
            }
        }

        function sendNotification(title, body, icon = 'üìö') {
            if (notificationsEnabled && 'Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">' + icon + '</text></svg>',
                    badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üìö</text></svg>'
                });
            }
        }

        function setupReminderSystem() {
            // Check for upcoming deadlines every minute
            setInterval(checkUpcomingDeadlines, 60000);
            checkUpcomingDeadlines(); // Check immediately
        }

        function checkUpcomingDeadlines() {
            if (!notificationsEnabled || !currentUser) return;
            
            const now = new Date();
            const userId = currentUser.email;
            
            homeworks.forEach(hw => {
                // Skip if user has completed this homework
                if (userCompletions[userId] && userCompletions[userId][hw.id]) return;
                
                const dueDate = new Date(hw.dueDate + ' ' + hw.dueTime);
                const timeDiff = dueDate - now;
                const hoursDiff = timeDiff / (1000 * 60 * 60);
                
                // Check if we should send a reminder
                const reminderKey = `${hw.id}_${userId}`;
                const sentReminders = JSON.parse(localStorage.getItem('sentReminders') || '{}');
                
                // 24 hour reminder
                if (hoursDiff <= 24 && hoursDiff > 23 && !sentReminders[reminderKey + '_24h']) {
                    sendNotification(
                        'üìÖ Homework Due Tomorrow',
                        `${hw.subject}: ${hw.title} is due tomorrow at ${hw.dueTime}`,
                        '‚è∞'
                    );
                    sentReminders[reminderKey + '_24h'] = true;
                    localStorage.setItem('sentReminders', JSON.stringify(sentReminders));
                }
                
                // 1 hour reminder
                if (hoursDiff <= 1 && hoursDiff > 0 && !sentReminders[reminderKey + '_1h']) {
                    sendNotification(
                        'üö® Homework Due Soon!',
                        `${hw.subject}: ${hw.title} is due in less than 1 hour!`,
                        'üö®'
                    );
                    sentReminders[reminderKey + '_1h'] = true;
                    localStorage.setItem('sentReminders', JSON.stringify(sentReminders));
                }
            });
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `notification ${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg max-w-sm`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">√ó</button>
                </div>
            `;
            
            document.getElementById('notificationContainer').appendChild(notification);
            setTimeout(() => notification.remove(), 5000);
        }

        // Save and load data with cross-device sync
        function saveData() {
            const globalData = {
                homeworks,
                answers,
                answersEnabled,
                userCompletions,
                reminderHistory,
                lastSync: new Date().toISOString()
            };
            
            const userData = {
                currentUser,
                lastLogin: new Date().toISOString()
            };
            
            // Save global data (shared across all devices/users)
            localStorage.setItem('homework_tracker_global', JSON.stringify(globalData));
            
            // Save user-specific data
            if (currentUser) {
                localStorage.setItem(`homework_tracker_user_${currentUser.email}`, JSON.stringify(userData));
            }
            
            // Simulate cloud sync - this ensures data persists across devices
            localStorage.setItem('homework_tracker_cloud_backup', JSON.stringify({
                global: globalData,
                users: getAllUserData(),
                cloudSync: true
            }));
        }

        function loadData() {
            // Load global data first (homework, answers, etc.)
            let globalData = localStorage.getItem('homework_tracker_global');
            
            // If no local data, try cloud backup
            if (!globalData) {
                const cloudBackup = localStorage.getItem('homework_tracker_cloud_backup');
                if (cloudBackup) {
                    const backup = JSON.parse(cloudBackup);
                    globalData = JSON.stringify(backup.global);
                }
            }
            
            if (globalData) {
                const data = JSON.parse(globalData);
                homeworks = data.homeworks || [];
                answers = data.answers || [];
                answersEnabled = data.answersEnabled || false;
                userCompletions = data.userCompletions || {};
                reminderHistory = data.reminderHistory || [];
            }
            
            // Load user session if exists
            loadUserSession();
        }

        function loadUserSession() {
            // Try to restore user session
            const allUsers = getAllUserEmails();
            for (const email of allUsers) {
                const userData = localStorage.getItem(`homework_tracker_user_${email}`);
                if (userData) {
                    const user = JSON.parse(userData);
                    if (user.currentUser && isRecentLogin(user.lastLogin)) {
                        currentUser = user.currentUser;
                        break;
                    }
                }
            }
        }

        function getAllUserData() {
            const users = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('homework_tracker_user_')) {
                    const email = key.replace('homework_tracker_user_', '');
                    users[email] = JSON.parse(localStorage.getItem(key));
                }
            }
            return users;
        }

        function getAllUserEmails() {
            const emails = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('homework_tracker_user_')) {
                    emails.push(key.replace('homework_tracker_user_', ''));
                }
            }
            return emails;
        }

        function isRecentLogin(lastLogin) {
            if (!lastLogin) return false;
            const loginTime = new Date(lastLogin);
            const now = new Date();
            const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
            return hoursDiff < 24; // Keep session for 24 hours
        }

        // Sync data periodically to ensure cross-device updates
        function syncData() {
            try {
                // In a real app, this would sync with a server
                // For demo, we simulate cross-device sync using localStorage
                
                const cloudBackup = localStorage.getItem('homework_tracker_cloud_backup');
                const localGlobal = localStorage.getItem('homework_tracker_global');
                
                if (cloudBackup) {
                    const backup = JSON.parse(cloudBackup);
                    
                    if (backup.global && backup.global.lastSync) {
                        // Check if cloud data is newer than local data
                        let shouldSync = false;
                        
                        if (!localGlobal) {
                            shouldSync = true;
                        } else {
                            const local = JSON.parse(localGlobal);
                            const cloudTime = new Date(backup.global.lastSync);
                            const localTime = new Date(local.lastSync || 0);
                            
                            if (cloudTime > localTime) {
                                shouldSync = true;
                            }
                        }
                        
                        if (shouldSync) {
                            // Update local data with cloud data
                            localStorage.setItem('homework_tracker_global', JSON.stringify(backup.global));
                            
                            // Reload data and update UI
                            const oldHomeworkCount = homeworks.length;
                            const oldAnswerCount = answers.length;
                            
                            loadData();
                            renderHomeworks();
                            renderAnswers();
                            renderProgressDashboard();
                            renderReminders();
                            
                            // Notify user of updates
                            const newHomeworkCount = homeworks.length;
                            const newAnswerCount = answers.length;
                            
                            if (newHomeworkCount > oldHomeworkCount) {
                                showNotification(`üìö ${newHomeworkCount - oldHomeworkCount} new homework assignment(s) added!`, 'info');
                            }
                            
                            if (newAnswerCount > oldAnswerCount) {
                                showNotification(`üìù ${newAnswerCount - oldAnswerCount} new answer key(s) available!`, 'info');
                            }
                        }
                    }
                }
                
                // Update sync indicator
                updateSyncStatus('synced');
                
            } catch (error) {
                console.error('Sync error:', error);
                updateSyncStatus('error');
            }
        }

        function updateSyncStatus(status) {
            // Add sync indicator to header
            let syncIndicator = document.getElementById('syncIndicator');
            if (!syncIndicator) {
                syncIndicator = document.createElement('div');
                syncIndicator.id = 'syncIndicator';
                syncIndicator.className = 'flex items-center space-x-2 text-sm';
                document.querySelector('header .flex.justify-between .flex.items-center').appendChild(syncIndicator);
            }
            
            switch (status) {
                case 'synced':
                    syncIndicator.innerHTML = '<span class="text-green-600">üîÑ Synced</span>';
                    break;
                case 'syncing':
                    syncIndicator.innerHTML = '<span class="text-blue-600">üîÑ Syncing...</span>';
                    break;
                case 'error':
                    syncIndicator.innerHTML = '<span class="text-red-600">‚ö†Ô∏è Sync Error</span>';
                    break;
            }
            
            // Hide indicator after 3 seconds
            setTimeout(() => {
                if (syncIndicator) {
                    syncIndicator.innerHTML = '';
                }
            }, 3000);
        }

        // Tab switching
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tab + 'Content').classList.add('active');
            
            if (tab === 'answers') {
                renderAnswers();
            } else if (tab === 'reminders') {
                renderReminders();
            }
        }

        // Auth functions
        function showAuthModal() {
            document.getElementById('authModal').classList.remove('hidden');
            document.getElementById('authModal').classList.add('flex');
        }

        function hideAuthModal() {
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('authModal').classList.remove('flex');
            document.getElementById('authForm').reset();
        }

        function handleAuth(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const name = document.getElementById('name').value.trim();
            
            if (!email || !name) {
                showNotification('Please fill all fields', 'warning');
                return;
            }
            
            const isAdmin = email === ADMIN_EMAIL;
            currentUser = {
                email,
                name,
                isAdmin,
                role: isAdmin ? 'Admin' : 'Student'
            };
            
            // Initialize user completions if not exists
            if (!userCompletions[email]) {
                userCompletions[email] = {};
            }
            
            saveData();
            updateUI();
            hideAuthModal();
            renderProgressDashboard();
            renderHomeworks();
            
            showNotification(`Welcome ${name}! ${isAdmin ? '(Admin Access Granted)' : ''}`, 'success');
        }

        function logout() {
            currentUser = null;
            saveData();
            updateUI();
            renderProgressDashboard();
            renderHomeworks();
            showNotification('Logged out successfully', 'info');
        }

        // Update UI based on user
        function updateUI() {
            const currentUserEl = document.getElementById('currentUser');
            const userRoleEl = document.getElementById('userRole');
            const authBtn = document.getElementById('authBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const adminPanel = document.getElementById('adminPanel');
            const adminAnswerControls = document.getElementById('adminAnswerControls');
            const adminReminderControls = document.getElementById('adminReminderControls');
            
            if (currentUser) {
                currentUserEl.textContent = currentUser.name;
                userRoleEl.textContent = currentUser.role;
                authBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                
                if (currentUser.isAdmin) {
                    adminPanel.classList.remove('hidden');
                    adminAnswerControls.classList.remove('hidden');
                    adminReminderControls.classList.remove('hidden');
                    document.getElementById('enableAnswers').checked = answersEnabled;
                } else {
                    adminPanel.classList.add('hidden');
                    adminAnswerControls.classList.add('hidden');
                    adminReminderControls.classList.add('hidden');
                }
            } else {
                currentUserEl.textContent = 'Not logged in';
                userRoleEl.textContent = 'Guest';
                authBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                adminPanel.classList.add('hidden');
                adminAnswerControls.classList.add('hidden');
                adminReminderControls.classList.add('hidden');
            }
        }

        // Homework functions
        function handleAddHomework(e) {
            e.preventDefault();
            
            if (!currentUser || !currentUser.isAdmin) {
                showNotification('Only admin can add homework', 'error');
                return;
            }
            
            const subject = document.getElementById('subject').value;
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const dueDate = document.getElementById('dueDate').value;
            const dueTime = document.getElementById('dueTime').value;
            const priority = document.getElementById('priority').value;
            
            if (!subject || !title || !description || !dueDate || !dueTime) {
                showNotification('Please fill all fields', 'warning');
                return;
            }
            
            const homework = {
                id: Date.now(),
                subject,
                title,
                description,
                dueDate,
                dueTime,
                priority,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            homeworks.push(homework);
            saveData();
            renderHomeworks();
            renderProgressDashboard();
            updateAnswerHomeworkOptions();
            
            document.getElementById('homeworkForm').reset();
            document.getElementById('dueDate').min = new Date().toISOString().split('T')[0];
            
            showNotification('Homework added successfully! All students will see it.', 'success');
        }

        function toggleComplete(id) {
            if (!currentUser) {
                showNotification('Please login to mark homework as complete', 'warning');
                return;
            }
            
            const userId = currentUser.email;
            if (!userCompletions[userId]) {
                userCompletions[userId] = {};
            }
            
            userCompletions[userId][id] = !userCompletions[userId][id];
            saveData();
            renderHomeworks();
            renderProgressDashboard();
            
            const homework = homeworks.find(h => h.id === id);
            const isCompleted = userCompletions[userId][id];
            
            showNotification(`${homework.title} marked as ${isCompleted ? 'complete' : 'incomplete'}`, 'success');
        }

        function deleteHomework(id) {
            if (!currentUser || !currentUser.isAdmin) {
                showNotification('Only admin can delete homework', 'error');
                return;
            }
            
            const homework = homeworks.find(h => h.id === id);
            if (!homework) return;
            
            if (confirm(`Delete "${homework.title}"? This will remove it for all students.`)) {
                homeworks = homeworks.filter(h => h.id !== id);
                answers = answers.filter(a => a.homeworkId !== id);
                
                // Remove from all user completions
                Object.keys(userCompletions).forEach(userId => {
                    if (userCompletions[userId][id]) {
                        delete userCompletions[userId][id];
                    }
                });
                
                saveData();
                renderHomeworks();
                renderProgressDashboard();
                renderAnswers();
                updateAnswerHomeworkOptions();
                showNotification('Homework deleted for all students', 'success');
            }
        }

        // Answer functions
        function toggleAnswerAccess() {
            if (!currentUser || !currentUser.isAdmin) return;
            
            answersEnabled = document.getElementById('enableAnswers').checked;
            saveData();
            renderAnswers();
            
            showNotification(`Answer access ${answersEnabled ? 'enabled' : 'disabled'} for all students`, 'success');
        }

        function showAddAnswerModal() {
            updateAnswerHomeworkOptions();
            document.getElementById('addAnswerModal').classList.remove('hidden');
            document.getElementById('addAnswerModal').classList.add('flex');
        }

        function hideAddAnswerModal() {
            document.getElementById('addAnswerModal').classList.add('hidden');
            document.getElementById('addAnswerModal').classList.remove('flex');
            document.getElementById('answerForm').reset();
            document.getElementById('imagePreview').innerHTML = '';
        }

        function handleImagePreview(e) {
            const files = e.target.files;
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'image-preview border border-gray-300 rounded-lg';
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function updateAnswerHomeworkOptions() {
            const select = document.getElementById('answerHomeworkId');
            select.innerHTML = '<option value="">Choose homework assignment</option>';
            
            homeworks.forEach(hw => {
                const hasAnswer = answers.some(a => a.homeworkId === hw.id);
                if (!hasAnswer) {
                    const option = document.createElement('option');
                    option.value = hw.id;
                    option.textContent = `${hw.subject} - ${hw.title}`;
                    select.appendChild(option);
                }
            });
        }

        function handleAddAnswer(e) {
            e.preventDefault();
            
            if (!currentUser || !currentUser.isAdmin) {
                showNotification('Only admin can add answers', 'error');
                return;
            }
            
            const homeworkId = parseInt(document.getElementById('answerHomeworkId').value);
            const content = document.getElementById('answerContent').value.trim();
            const imageFiles = document.getElementById('answerImages').files;
            
            if (!homeworkId || !content) {
                showNotification('Please fill all required fields', 'warning');
                return;
            }
            
            const homework = homeworks.find(h => h.id === homeworkId);
            if (!homework) {
                showNotification('Homework not found', 'error');
                return;
            }
            
            // Process images
            const images = [];
            const processImages = Array.from(imageFiles).map(file => {
                return new Promise(resolve => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            images.push({
                                name: file.name,
                                data: e.target.result
                            });
                            resolve();
                        };
                        reader.readAsDataURL(file);
                    } else {
                        resolve();
                    }
                });
            });
            
            Promise.all(processImages).then(() => {
                const answer = {
                    id: Date.now(),
                    homeworkId,
                    content,
                    images,
                    createdBy: currentUser.name,
                    createdAt: new Date().toISOString()
                };
                
                answers.push(answer);
                saveData();
                renderAnswers();
                hideAddAnswerModal();
                
                showNotification('Answer key added successfully!', 'success');
            });
        }

        function deleteAnswer(id) {
            if (!currentUser || !currentUser.isAdmin) {
                showNotification('Only admin can delete answers', 'error');
                return;
            }
            
            if (confirm('Delete this answer key?')) {
                answers = answers.filter(a => a.id !== id);
                saveData();
                renderAnswers();
                updateAnswerHomeworkOptions();
                showNotification('Answer key deleted', 'success');
            }
        }

        // Reminder functions
        function showSendReminderModal() {
            document.getElementById('sendReminderModal').classList.remove('hidden');
            document.getElementById('sendReminderModal').classList.add('flex');
        }

        function hideSendReminderModal() {
            document.getElementById('sendReminderModal').classList.add('hidden');
            document.getElementById('sendReminderModal').classList.remove('flex');
            document.getElementById('reminderForm').reset();
        }

        function handleSendReminder(e) {
            e.preventDefault();
            
            if (!currentUser || !currentUser.isAdmin) {
                showNotification('Only admin can send reminders', 'error');
                return;
            }
            
            const title = document.getElementById('reminderTitle').value.trim();
            const message = document.getElementById('reminderMessage').value.trim();
            
            if (!title || !message) {
                showNotification('Please fill all fields', 'warning');
                return;
            }
            
            const reminder = {
                id: Date.now(),
                title,
                message,
                sentBy: currentUser.name,
                sentAt: new Date().toISOString(),
                type: 'custom'
            };
            
            reminderHistory.push(reminder);
            saveData();
            renderReminders();
            hideSendReminderModal();
            
            // Send notification to current user (in real app, would send to all users)
            sendNotification(title, message, 'üì¢');
            
            showNotification('Reminder sent to all users!', 'success');
        }

        // Render functions
        function renderProgressDashboard() {
            const container = document.getElementById('progressDashboard');
            
            if (!currentUser) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <p class="text-gray-500 text-lg">Please login to see your progress</p>
                    </div>
                `;
                return;
            }
            
            if (homeworks.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <p class="text-gray-500 text-lg">No homework assignments yet</p>
                        <p class="text-gray-400 text-sm mt-2">Admin will add assignments soon</p>
                    </div>
                `;
                return;
            }

            const userId = currentUser.email;
            const userProgress = userCompletions[userId] || {};
            
            const totalHomeworks = homeworks.length;
            const completedHomeworks = Object.values(userProgress).filter(Boolean).length;
            const overdueHomeworks = homeworks.filter(hw => {
                const dueDate = new Date(hw.dueDate + ' ' + hw.dueTime);
                return dueDate < new Date() && !userProgress[hw.id];
            }).length;
            const completionRate = totalHomeworks > 0 ? Math.round((completedHomeworks / totalHomeworks) * 100) : 0;

            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-blue-400 to-blue-600 text-white p-6 rounded-xl shadow-lg">
                        <div class="text-3xl font-bold">${totalHomeworks}</div>
                        <div class="text-blue-100">Total Assignments</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-400 to-green-600 text-white p-6 rounded-xl shadow-lg">
                        <div class="text-3xl font-bold">${completedHomeworks}</div>
                        <div class="text-green-100">You Completed</div>
                    </div>
                    <div class="bg-gradient-to-br from-red-400 to-red-600 text-white p-6 rounded-xl shadow-lg">
                        <div class="text-3xl font-bold">${overdueHomeworks}</div>
                        <div class="text-red-100">Your Overdue</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-400 to-purple-600 text-white p-6 rounded-xl shadow-lg">
                        <div class="text-3xl font-bold">${completionRate}%</div>
                        <div class="text-purple-100">Your Progress</div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-semibold">Your Progress</h3>
                        <span class="text-sm text-gray-600">${completedHomeworks}/${totalHomeworks} completed</span>
                    </div>
                    <div class="bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div class="bg-gradient-to-r from-green-400 to-green-600 h-4 rounded-full transition-all duration-1000" style="width: ${completionRate}%"></div>
                    </div>
                </div>
            `;
        }

        function renderHomeworks() {
            const container = document.getElementById('homeworkList');
            
            if (homeworks.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <p class="text-gray-500 text-lg">No homework assignments yet</p>
                        <p class="text-gray-400 text-sm mt-2">Admin can add assignments to get started</p>
                    </div>
                `;
                return;
            }

            const userId = currentUser ? currentUser.email : null;
            const userProgress = userId ? (userCompletions[userId] || {}) : {};

            // Sort: incomplete first, then by due date
            const sorted = [...homeworks].sort((a, b) => {
                const aCompleted = userId ? userProgress[a.id] : false;
                const bCompleted = userId ? userProgress[b.id] : false;
                
                if (aCompleted !== bCompleted) return aCompleted ? 1 : -1;
                return new Date(a.dueDate + ' ' + a.dueTime) - new Date(b.dueDate + ' ' + b.dueTime);
            });

            container.innerHTML = sorted.map(hw => {
                const dueDate = new Date(hw.dueDate + ' ' + hw.dueTime);
                const isCompleted = userId ? userProgress[hw.id] : false;
                const isOverdue = dueDate < new Date() && !isCompleted;
                const priorityColors = {
                    high: 'bg-red-100 text-red-800',
                    medium: 'bg-yellow-100 text-yellow-800',
                    low: 'bg-green-100 text-green-800'
                };
                const priorityIcons = { high: 'üî¥', medium: 'üü°', low: 'üü¢' };
                
                // Get completion stats for this homework
                const completionStats = Object.keys(userCompletions).reduce((stats, email) => {
                    if (userCompletions[email][hw.id]) stats.completed++;
                    stats.total++;
                    return stats;
                }, { completed: 0, total: 0 });
                
                return `
                    <div class="homework-card bg-white rounded-xl p-6 mb-4 shadow-lg border border-gray-100 priority-${hw.priority} ${isCompleted ? 'opacity-60' : ''}">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex flex-wrap gap-2 mb-3">
                                    <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-medium">${hw.subject}</span>
                                    <span class="${priorityColors[hw.priority]} px-3 py-1 rounded-full text-sm font-medium">
                                        ${priorityIcons[hw.priority]} ${hw.priority.charAt(0).toUpperCase() + hw.priority.slice(1)} Priority
                                    </span>
                                    ${isCompleted ? '<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">‚úÖ You Completed</span>' : ''}
                                    ${isOverdue ? '<span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium">‚ö†Ô∏è Overdue</span>' : ''}
                                    ${completionStats.total > 0 ? `<span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">üë• ${completionStats.completed}/${completionStats.total} completed</span>` : ''}
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-2 ${isCompleted ? 'line-through' : ''}">${hw.title}</h3>
                                <p class="text-gray-600 mb-3">${hw.description}</p>
                                <div class="text-sm text-gray-500">
                                    <p><strong>Due:</strong> ${new Date(hw.dueDate).toLocaleDateString()} at ${hw.dueTime}</p>
                                    <p><strong>Added by:</strong> ${hw.createdBy}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center pt-4 border-t border-gray-100">
                            <div class="flex space-x-2">
                                ${currentUser ? `
                                    <button onclick="toggleComplete(${hw.id})" class="px-4 py-2 rounded-lg text-sm font-medium transition-all transform hover:scale-105 ${isCompleted ? 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200' : 'bg-green-100 text-green-800 hover:bg-green-200'}">
                                        ${isCompleted ? '‚Ü©Ô∏è Mark Incomplete' : '‚úÖ Mark Complete'}
                                    </button>
                                ` : `
                                    <span class="px-4 py-2 bg-gray-100 text-gray-500 rounded-lg text-sm">Login to mark complete</span>
                                `}
                            </div>
                            
                            ${currentUser && currentUser.isAdmin ? `
                                <button onclick="deleteHomework(${hw.id})" class="px-4 py-2 bg-red-100 text-red-800 hover:bg-red-200 rounded-lg text-sm font-medium transition-all transform hover:scale-105">
                                    üóëÔ∏è Delete
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderAnswers() {
            const container = document.getElementById('answersContainer');
            
            // Check access
            if (!currentUser) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="locked-overlay rounded-xl p-8">
                            <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                            <h3 class="text-xl font-bold text-white mb-2">Login Required</h3>
                            <p class="text-gray-300">Please login to access answer keys</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            if (!currentUser.isAdmin && !answersEnabled) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="locked-overlay rounded-xl p-8">
                            <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                            <h3 class="text-xl font-bold text-white mb-2">Access Restricted</h3>
                            <p class="text-gray-300">Answer keys are currently disabled by admin</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            if (answers.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <p class="text-gray-500 text-lg">No answer keys available yet</p>
                        <p class="text-gray-400 text-sm mt-2">${currentUser.isAdmin ? 'Add answer keys for homework assignments' : 'Admin will add answer keys when available'}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = answers.map(answer => {
                const homework = homeworks.find(h => h.id === answer.homeworkId);
                if (!homework) return '';
                
                return `
                    <div class="answer-card rounded-xl p-6 mb-6 shadow-lg">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-3">
                                    <span class="bg-white bg-opacity-20 text-white px-3 py-1 rounded-full text-sm font-medium">${homework.subject}</span>
                                    <span class="bg-white bg-opacity-20 text-white px-3 py-1 rounded-full text-sm font-medium">üìù Answer Key</span>
                                </div>
                                <h3 class="text-xl font-bold text-white mb-2">${homework.title}</h3>
                                <p class="text-white text-opacity-90 text-sm mb-4">Added by ${answer.createdBy} ‚Ä¢ ${new Date(answer.createdAt).toLocaleDateString()}</p>
                            </div>
                            ${currentUser.isAdmin ? `
                                <button onclick="deleteAnswer(${answer.id})" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all">
                                    üóëÔ∏è Delete
                                </button>
                            ` : ''}
                        </div>
                        
                        <div class="bg-white bg-opacity-10 rounded-lg p-4 mb-4">
                            <h4 class="font-semibold text-white mb-2">Answer Key:</h4>
                            <div class="text-white text-opacity-90 whitespace-pre-wrap">${answer.content}</div>
                        </div>
                        
                        ${answer.images && answer.images.length > 0 ? `
                            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                <h4 class="font-semibold text-white mb-3">Images:</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    ${answer.images.map(img => `
                                        <div class="bg-white rounded-lg p-2">
                                            <img src="${img.data}" alt="${img.name}" class="w-full h-auto rounded">
                                            <p class="text-xs text-gray-600 mt-1 text-center">${img.name}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).filter(html => html).join('');
        }

        function renderReminders() {
            const container = document.getElementById('reminderHistory');
            
            if (reminderHistory.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path>
                        </svg>
                        <p class="text-gray-500 text-lg">No reminders sent yet</p>
                        <p class="text-gray-400 text-sm mt-2">${currentUser && currentUser.isAdmin ? 'Send custom reminders to all students' : 'Admin can send reminders here'}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">üìú Reminder History</h3>
                    ${reminderHistory.slice().reverse().map(reminder => `
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-4">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-semibold text-gray-900">${reminder.title}</h4>
                                <span class="text-xs text-gray-500">${new Date(reminder.sentAt).toLocaleString()}</span>
                            </div>
                            <p class="text-gray-700 mb-2">${reminder.message}</p>
                            <div class="flex items-center text-xs text-gray-500">
                                <span>üì¢ Sent by ${reminder.sentBy}</span>
                                <span class="mx-2">‚Ä¢</span>
                                <span>${reminder.type === 'custom' ? 'Custom Reminder' : 'Auto Reminder'}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Make functions global
        window.switchTab = switchTab;
        window.showAuthModal = showAuthModal;
        window.hideAuthModal = hideAuthModal;
        window.logout = logout;
        window.toggleComplete = toggleComplete;
        window.deleteHomework = deleteHomework;
        window.toggleAnswerAccess = toggleAnswerAccess;
        window.showAddAnswerModal = showAddAnswerModal;
        window.hideAddAnswerModal = hideAddAnswerModal;
        window.deleteAnswer = deleteAnswer;
        window.requestNotificationPermission = requestNotificationPermission;
        window.showSendReminderModal = showSendReminderModal;
        window.hideSendReminderModal = hideSendReminderModal;
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'983cecbfd1da3052',t:'MTc1ODY2MDczNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
